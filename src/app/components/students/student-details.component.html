<div class="container my-4">
  <!-- Row 1: Tiles for Photo, Basic Info, Class -->
  <div class="row g-4 mb-4 justify-content-center">
    <!-- Photo Tile -->
    <div class="col-12 col-md-3">
      <div class="tile islamic-tile d-flex flex-column h-100">
        <div class="tile-header bg-info text-white text-center py-2">Photo</div>
        <div class="tile-body d-flex flex-column align-items-center justify-content-center flex-grow-1">
          <img
            [src]="getStudentPhotoUrl()"
            alt="Student Photo"
            class="img-fluid rounded-circle shadow-sm mb-3"
            style="max-height: 150px; cursor: pointer;"
            (click)="fileInput.click()">
          <input
            #fileInput
            type="file"
            accept="image/*"
            style="display: none;"
            (change)="onPhotoSelected($event)">

          <!-- Photo Upload/Capture Buttons -->
          <div class="button-group">
            <button
              class="btn btn-sm btn-outline-primary mb-2"
              (click)="fileInput.click()"
              [disabled]="uploadingPhoto">
              <span *ngIf="!uploadingPhoto">üì§ Upload Photo</span>
              <span *ngIf="uploadingPhoto">
                <span class="spinner-border spinner-border-sm me-2"></span>Uploading...
              </span>
            </button>
            <button
              class="btn btn-sm btn-outline-info"
              (click)="openCamera()">
              üì∑ Capture Photo
            </button>
          </div>

          <small class="text-muted mt-2 text-center">
            <em>Click photo to upload or use capture option</em>
          </small>
        </div>
      </div>
    </div>

    <!-- Basic Info Tile -->
    <div class="col-12 col-md-3">
      <div class="tile islamic-tile d-flex flex-column h-100">
        <div class="tile-header bg-success text-white text-center py-2">Basic Info</div>
        <div class="tile-body flex-grow-1">
          <p><strong>Name:</strong> {{ student?.name }} {{ student?.surName }}</p>
          <p><strong>Age:</strong> {{ student?.age }}</p>
          <p><strong>Gender:</strong> {{ student?.gender }}</p>
          <p><strong>Father Name:</strong> {{ student?.fatherName }}</p>
          <p><strong>Guardian Name:</strong> {{ student?.guardianName }}</p>
          <p><strong>Phone:</strong> {{ student?.phone }}</p>
          <p><strong>Whatsapp:</strong> {{ student?.whatsapp }}</p>
          <p><strong>Admission Date:</strong> {{ student?.admissionDate }}</p>
        </div>
      </div>
    </div>

    <!-- Class Tile -->
    <div class="col-12 col-md-3">
      <div class="tile islamic-tile d-flex flex-column h-100">
        <div class="tile-header bg-warning text-dark text-center py-2">Class</div>
        <div class="tile-body flex-grow-1">
          <p><strong>Class:</strong> {{ student?.maktabClass?.name }}</p>
          <p><strong>Division:</strong> {{ student?.maktabClass?.division }}</p>
          <p><strong>Timing:</strong> {{ student?.maktabClass?.timing }}</p>
          <h6 class="mt-3">Teachers</h6>
          <div class="table-responsive">
            <table class="table table-sm table-bordered islamic-table mb-0">
              <thead class="table-light">
              <tr>
                <th>Name</th>
                <th>Phone</th>
              </tr>
              </thead>
              <tbody>
              <tr *ngFor="let teacher of teachers">
                <td>{{ teacher.fullName }}</td>
                <td>{{ teacher.phone }}</td>
              </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Row 2: Fees and Attendance Tiles -->
  <div class="row g-4 mb-4 justify-content-center">
    <!-- Fees Tile -->
    <div class="col-12 col-md-5">
      <div class="tile islamic-tile d-flex flex-column h-100">
        <div class="tile-header bg-primary text-white text-center py-2">Fees</div>
        <div class="tile-body flex-grow-1">
          <p><strong>Total Fees:</strong> ‚Çπ{{ totalFees }}</p>
          <p><strong>Paid:</strong> ‚Çπ{{ paidFees }}</p>
          <p><strong>Due:</strong> ‚Çπ{{ dueFees }}</p>
          <div *ngIf="!student?.fees" class="text-muted text-center">
            Fees data not available.
          </div>
        </div>
      </div>
    </div>

    <!-- Attendance Tile -->
    <div class="col-12 col-md-5">
      <div class="tile islamic-tile d-flex flex-column h-100">
        <div class="tile-header bg-secondary text-white text-center py-2">Attendance</div>
        <div class="tile-body flex-grow-1">
          <p><strong>Absent:</strong> {{ attendanceSummary?.absent || 0 }} days</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="text-center mb-4 justify-content-center">
    <button class="btn btn-success mx-2" (click)="openEditModal(student)">‚úè Edit</button>
    <button class="btn btn-info mx-2" (click)="getAttendance(student.id!)">üìÖ Attendance</button>
    <button class="btn btn-warning mx-2" (click)="getFeesDetails(student.id!)">üí∞ Fees</button>
    <button appBackButton class="btn btn-secondary mx-2">Back</button>
  </div>

  <!-- Edit Modal -->
  <div class="modal fade" [class.show]="showModal" [style.display]="showModal ? 'block' : 'none'" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title">Edit Student</h5>
          <button type="button" class="btn-close btn-close-white" (click)="closeModal()"></button>
        </div>
        <div class="modal-body">
          <form *ngIf="editingStudent">
            <!-- Name Row -->
            <div class="row mb-3">
              <div class="col-md-6">
                <label for="name" class="form-label">First Name</label>
                <input type="text" class="form-control" id="name" [(ngModel)]="editingStudent.name" name="name">
              </div>
              <div class="col-md-6">
                <label for="surName" class="form-label">Last Name</label>
                <input type="text" class="form-control" id="surName" [(ngModel)]="editingStudent.surName" name="surName">
              </div>
            </div>

            <!-- Age and Gender Row -->
            <div class="row mb-3">
              <div class="col-md-6">
                <label for="age" class="form-label">Age</label>
                <input type="number" class="form-control" id="age" [(ngModel)]="editingStudent.age" name="age">
              </div>
              <div class="col-md-6">
                <label for="gender" class="form-label">Gender</label>
                <select class="form-control" id="gender" [(ngModel)]="editingStudent.gender" name="gender">
                  <option>Male</option>
                  <option>Female</option>
                </select>
              </div>
            </div>

            <!-- Father and Guardian Row -->
            <div class="row mb-3">
              <div class="col-md-6">
                <label for="fatherName" class="form-label">Father Name</label>
                <input type="text" class="form-control" id="fatherName" [(ngModel)]="editingStudent.fatherName" name="fatherName">
              </div>
              <div class="col-md-6">
                <label for="guardianName" class="form-label">Guardian Name</label>
                <input type="text" class="form-control" id="guardianName" [(ngModel)]="editingStudent.guardianName" name="guardianName">
              </div>
            </div>

            <!-- Phone and WhatsApp Row -->
            <div class="row mb-3">
              <div class="col-md-6">
                <label for="phone" class="form-label">Phone</label>
                <input type="text" class="form-control" id="phone" [(ngModel)]="editingStudent.phone" name="phone">
              </div>
              <div class="col-md-6">
                <label for="whatsapp" class="form-label">WhatsApp</label>
                <input type="text" class="form-control" id="whatsapp" [(ngModel)]="editingStudent.whatsapp" name="whatsapp">
              </div>
            </div>

            <!-- Photo Section in Modal -->
            <div class="mb-3">
              <label class="form-label">Student Photo</label>
              <div class="d-flex gap-2">
                <button type="button" class="btn btn-outline-secondary btn-sm" (click)="modalFileInput.click()">
                  üì§ Upload Photo
                </button>
                <button type="button" class="btn btn-outline-secondary btn-sm" (click)="openCamera()">
                  üì∑ Take Photo
                </button>
              </div>
              <input
                #modalFileInput
                type="file"
                accept="image/*"
                style="display: none;"
                (change)="onPhotoSelected($event)">
              <div *ngIf="photoPreview" class="mt-3 text-center photo-preview-box">
                <img [src]="photoPreview" alt="Photo Preview" class="img-fluid rounded" style="max-width: 250px; max-height: 250px;">
                <p class="text-success mt-2">‚úì Photo ready</p>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="closeModal()">Close</button>
          <button type="button" class="btn btn-primary" (click)="updateStudent()">Save Changes</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Backdrop -->
  <div class="modal-backdrop fade" [class.show]="showModal" *ngIf="showModal"></div>

  <!-- Camera Modal -->
  <div class="modal fade" [class.show]="showCamera" [style.display]="showCamera ? 'block' : 'none'" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header bg-info text-white">
          <h5 class="modal-title">Capture Photo</h5>
          <button type="button" class="btn-close btn-close-white" (click)="closeCamera()"></button>
        </div>
        <div class="modal-body">
          <div class="text-center">
            <video #cameraVideo autoplay playsinline muted
                   width="100%" height="400"
                   style="max-height: 400px; border-radius: 8px; background-color: #000; object-fit: cover;">
            </video>
            <p class="text-muted mt-2">Allow camera access if prompted</p>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="closeCamera()">Cancel</button>
          <button type="button" class="btn btn-primary" (click)="capturePhoto(cameraVideo)">Capture Photo</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Camera Modal Backdrop -->
  <div class="modal-backdrop fade" [class.show]="showCamera" *ngIf="showCamera"></div>
</div>
