<div class="container mt-3">
  <h2 class="page-title">ğŸ“Š School Reports</h2>

  <!-- Filters -->
  <div class="report-filters">
    <label>
      Select Report:
      <select [(ngModel)]="selectedReport" >
        <option value="attendance">ğŸ“‹ Attendance Report</option>
        <option value="fees">ğŸ’° Fees Report</option>
        <option value="exam-results">âœï¸ Exam Results</option>
        <option value="student-performance">â­ Student Performance</option>
        <option value="teacher-performance">ğŸ‘¨â€ğŸ« Teacher Performance</option>
      </select>
    </label>

    <label>
      Month<span style="color: red">*</span>:
      <select [(ngModel)]="selectedMonth" >
        <option value="">All Months</option>
        <option *ngFor="let month of months" [value]="month">{{ month }}</option>
      </select>
    </label>

    <label>
      Class:
      <select [(ngModel)]="selectedClass" >
        <option value="">All Classes</option>
        <option *ngFor="let cls of classes" [value]="cls.id">{{cls.name}}</option>
      </select>
    </label>

    <label *ngIf="this.selectedReport === 'fees'">
      Status:
      <select [(ngModel)]="selectedStatus">
        <option value="">All Status</option>
        <option value="PAID">Paid</option>
        <option value="UNPAID">Un-paid</option>
        <option value="FI-SABILILLAH">Fi Sabilillah</option>
      </select>
    </label>
    <label>
      Search:
      <button class="btn-primary" (click)="loadReport()">Submit</button>
    </label>
    <label *ngIf="reportData && reportData.length >0">
      Download Report:
      <button *ngIf="reportData && reportData.length >0" class="btn-secondary" (click)="downloadReport()">Download</button>
    </label>
  </div>
  <div   *ngIf="selectColumns">
    <span>Select columns to export: </span>
    <label *ngFor="let col of columns" style="margin-right: 10px;">
      <input type="checkbox" [(ngModel)]="col.selected" />
      {{ col.header }}
    </label>

    <button (click)="exportSelectedColumnsToExcel()">Download Excel</button>
  </div>
  <!-- Dynamic Report -->
  <div class="report-section" *ngIf="reportData && reportData.length">
    <h3>{{ reportTitle }}</h3>
    <div class="table-wrapper">
      <table class="report-table">
        <thead>
        <tr>
          <th *ngFor="let col of tableColumns">{{ col }}</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let row of reportData; let i = index">
          <td>{{i+1}}</td>
          <td><a [routerLink]="['/student/details', row.studentId]">{{ row.studentFullName }}</a>
            <label class="col-form-label-sm" *ngIf="row.studentFullName.indexOf('*')!=-1"></label>
          </td>
          <td >{{ row.className }}</td>
          <td >{{ row.phone }}</td>
          <td >{{ row.month }}</td>
          <td >{{ row.status }}</td>
          <td >{{ row.paidAmount }}</td>
          <td >{{ row.dueAmount }}</td>
          <td >{{ row.remark }}</td>
        </tr>
        </tbody>

      </table>
    </div>
  </div>

  <p *ngIf="!reportData || !reportData.length" class="no-data">No data available for the selected filters</p>

  <div class="action-buttons-left">
    <button appBackButton class="btn-secondary">Back</button>
  </div>
</div>
