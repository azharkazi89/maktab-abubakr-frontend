<div class="container mt-3">

  <div class="page-header">
    <h2 class="page-title">ðŸ’° Fees Management</h2>
    <h5>Total Fees Collected: Rs: {{calculateTotalFeesPaidAllStudents()}}/-</h5>
    <h5>Total Fees Pending till date: Rs: {{calculateTotalFeesPendingAllStudents()}}/-</h5>
  </div>

  <!-- Filters -->
  <div class="fees-filters">
    <select [(ngModel)]="selectedClass">
      <option value="">All Classes</option>
      <option *ngFor="let cls of classes" [value]="cls.id">{{cls.name}}</option>
    </select>

    <!--<select [(ngModel)]="selectedMonth">
      <option value="">All Months</option>
      <option *ngFor="let m of months" [value]="m">{{m}}</option>
    </select>-->

    <select [(ngModel)]="selectedStatus">
      <option value="ALL">All Status</option>
      <option value="PAID">Paid</option>
      <option value="DUE">Due</option>
      <option value="FI-SABILILLAH">Fi Sabilillah</option>
    </select>
    <input class="large-input" type="text" placeholder="Search by name, contact, roll no" [(ngModel)]="searchText">
  </div>

  <!-- Bulk actions -->
 <div class="bulk-actions">
    <button class="action-btn paid" (click)="assignFees('PAID')">âœ” Mark Selected as Paid</button>
    <button class="action-btn unpaid" (click)="assignFees('DUE')">âœ– Mark Selected as Unpaid</button>
    <button class="action-btn notify" (click)="bulkNotifyParents()">ðŸ“© Notify Parents</button>
  </div>


  <!-- Fees Table -->
  <div class="table-wrapper">
    <table class="fees-table">
      <thead>
      <tr>
        <th>
          <input type="checkbox" [(ngModel)]="selectAll" (ngModelChange)="toggleAllSelection()"></th>
        <th>#</th>
        <th>Student Name</th>
        <th>Class</th>
        <th>Phone</th>
        <th>Admission Date</th>
        <th>Total Fee Paid</th>
        <th>Total Fee Pending</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let s of filteredStudents(); let i = index">
        <td>  <input type="checkbox"
                     [checked]="s.selected"
                     (change)="toggleSelection(s)"></td>
        <td>{{i+1}}</td>
        <td><a [routerLink]="['/student', s.id, 'fees']">{{ s.name.replace('*', '') }}</a>
          <span class="badge bg-info ms-1" *ngIf="s.name.endsWith('*')">EBC</span>
        </td>
        <td>{{ s.maktabClass?.name }}</td>
        <td>{{ s.phone }}</td>
        <td>{{s.admissionDate}}</td>
        <td>Rs. {{ calculateTotalFeesPaid(s) }}/-</td>
        <td>Rs. {{ calculateTotalFeesPending(s) }}/-</td>
      </tr>
      </tbody>
    </table>
    <div class="pagination-wrapper" *ngIf="totalPages > 1">
      <app-pagination
        [currentPage]="currentPage"
        [totalPages]="totalPages"
        (pageChange)="loadStudentFees($event)">
      </app-pagination>
    </div>
  </div>

  <button appBackButton class="btn-secondary">Back</button>
</div>
